---
title: "Methodology"
output: 
  html_document:
    theme: cerulean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F, cache = T, resuts = F, fig.align = 'center')
```


Yapa is a simple poll aggregator that estimates state-level support for US presidential candidates by combining state-level polls with previous election results.  It relies only on polling data and prior election results, not economic or demographic indicators.  Its strength is appropriate handling of uncertainty.  80% intervals are calibrated to include 80% of results in previous presidential elections.

# Model

We model state level support for each presidential candidate with three layers:

1) **Prior**: the results in that state from the previous general election, adjusted by partisan swings between previous national election results and current national polls;
2) **Data**: state-level polls, weighted by recency and sample size;
3) **Non-sampling error**: polling error based on its historical distribution.

Specifically, the number of respondents that support each candidate in each poll $y_{p, c}$ is drawn from the total respondents in that poll $n_p$ at a candidate and state specific polling average $\theta_{s, c}$.  The polling averages are drawn from a measurement error model of true underlying support for each candidate in each state $\mu_{s, c}$, with candidate-state specific errors inferred from historical polling averages and election results. The true support $\mu_{s, c}$ is drawn from a distribution centered at the results for each candidate in each state in the previous election, with a standard deviation equal to historical state-level swings between presidential elections of 6%.

$$
\begin{align}
y_{p, c} &\sim Binomial(n_p, \theta_{s, c}) \\
\theta_{s, c} &\sim Normal(\mu_{s, c} + \epsilon_{s, c}, \sigma_{s, c}) \\
\mu_{s, c} &\sim Normal(\alpha_{s, c}, 0.06) \\
\sum_c \mu_s &= 1 
\end{align}
$$

All code and data are available at [github.com/alexpavlakis/yapa](https://github.com/alexpavlakis/yapa).

## Weighting 

Polls tend to contribute more to final inferences if they have a) larger sample sizes and b) are closer to the election. We discount polls by recency according to the exponential decay model:

$$
discount_p = e^\frac{-days\_out_p}{\gamma}
$$

```{r fig.align='center', echo = F}
days <- seq(0, 365, 1)
wt <- exp(-days/40)

par(las = 1, mar = c(4, 4, 1, 1))
plot(days, wt, type = "l", bty = 'n', xaxt = 'n',
     xlab = "days from election", ylab = "discount factor",
     main = NULL)
axis(1, at = seq(0, 300, 30))
```
