---
title: "Methodology"
output: 
  html_document:
    theme: cerulean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F, cache = T, resuts = F)
```


Yapa is a simple poll aggregator that estimates state-level support for US presidential candidates by combining state-level polls with prior election results.  

# Model

We model state level support for each presidential candidate in three layers:

1) **Prior**: a baseline level of support for each candidate in each state.  Our default is the previous election results, with wide uncertainty;
2) **Data**: state-level polls, weighted by time from election day and sample size;
3) **Non-sampling error**: we simulate true underlying support, assuming that state-level polls may be biased and that those biases may be correlated (e.g., if polls are biased toward the Republican candidate in Wisconsin, they're probably biased toward the Republican candidate in Michigan too).  Since we won't know the true bias until after the election, we allow for a wide range of potential biases when simulating true underlying support.

Specifically, the number of respondents that support each candidate in each poll $y_{p, c}$ is drawn from the total respondents in that poll $n_p$ at a rate specific to the candidate and the state $\theta_{s, c}$.  The rate parameters is distributed with a candidate-state specific center $\alpha_{c, s}$ and state specific scale $t_s$.  The sum of proportions for each candidate must equal one.  Finally, to simulate true underlying support, we first sample a vector of *biases* for each candidate, then sample support based on each state's rate parameter and the sampled bias.  These simulations are repeated tens of thousands of times.

$$
\begin{align}
y_{p, c} &\sim Binomial(n_p, \theta_{s, c}) \\
\theta_{s, c} &\sim Student\_t(\nu, \alpha_{s, c}, \tau_{s}) \\
\sum_c \theta_s &= 1 
\end{align}
$$

In this model, we use the results of the previous presidential election in each state as prior $\alpha$.  All code and data are available at [github.com/alexpavlakis/yapa](https://github.com/alexpavlakis/yapa).

## Weighting 

Polls tend to contribute more to final inferences if they have a) larger sample sizes and b) are closer to the election. We weight polls by recency according to the exponential decay model:

$$
wt_p = e^\frac{-days\_out_p}{60}
$$

```{r fig.align='center', echo = F}
days <- seq(0, 365, 1)
wt <- exp(-days/60)

par(las = 1, mar = c(4, 4, 1, 1))
plot(days, wt, type = "l", bty = 'n', 
     xlab = "days from election", ylab = "poll weight",
     main = NULL)
```



